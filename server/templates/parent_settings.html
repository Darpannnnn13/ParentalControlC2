<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; }
        .settings-card { border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container-fluid">
            <a class="navbar-brand" href="/parent/dashboard">üë®‚Äçüë©‚Äçüëß Parent Control</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/parent/dashboard">üìä Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/parent/monitoring">üì± Monitoring</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/parent/subscription">üíé Subscription</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/parent/reports">üìä Reports</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown">
                            üë§ Account
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="profileDropdown">
                            <li><a class="dropdown-item active" href="/parent/settings">‚öôÔ∏è Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/logout">üö™ Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Settings Menu -->
            <div class="col-md-3 mb-4">
                <div class="list-group">
                    <a href="#profile" class="list-group-item list-group-item-action active" data-bs-toggle="list">üë§ Profile</a>
                    <a href="#security" class="list-group-item list-group-item-action" data-bs-toggle="list">üîê Security</a>
                    <a href="#notifications" class="list-group-item list-group-item-action" data-bs-toggle="list">üîî Notifications</a>
                    <a href="#privacy" class="list-group-item list-group-item-action" data-bs-toggle="list">üëÅÔ∏è Privacy</a>
                    <a href="#advanced" class="list-group-item list-group-item-action" data-bs-toggle="list">‚öôÔ∏è Advanced</a>
                </div>
            </div>

            <!-- Settings Content -->
            <div class="col-md-9">
                <!-- Profile Settings -->
                <div id="profile" class="card settings-card shadow mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üë§ Profile Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" value="{{ parent.email }}" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="phone" placeholder="+91-XXXXXXXXXX">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="address" rows="2" placeholder="Your address"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="saveProfile()">üíæ Save Changes</button>
                    </div>
                </div>

                <!-- Security Settings -->
                <div id="security" class="card settings-card shadow mb-4" style="display: none;">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">üîê Security Settings</h5>
                    </div>
                    <div class="card-body">
                        <h6 class="mb-3">Change Password</h6>
                        <div class="mb-3">
                            <label class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword">
                        </div>
                        <button class="btn btn-danger" onclick="changePassword()">Change Password</button>

                        <hr class="my-4">

                        <h6 class="mb-3">Two-Factor Authentication (2FA)</h6>
                        <p class="text-muted small">Add an extra layer of security to your account.</p>
                        <button class="btn btn-outline-danger" onclick="enable2FA()">Enable 2FA</button>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div id="notifications" class="card settings-card shadow mb-4" style="display: none;">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üîî Notification Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="emailAlerts" checked>
                            <label class="form-check-label" for="emailAlerts">Email Alerts</label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="smsAlerts" checked>
                            <label class="form-check-label" for="smsAlerts">SMS Alerts</label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="pushNotifications" checked>
                            <label class="form-check-label" for="pushNotifications">Push Notifications</label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="keywordAlerts" checked>
                            <label class="form-check-label" for="keywordAlerts">Keyword Alerts</label>
                        </div>
                        <button class="btn btn-info" onclick="saveNotifications()">Save Notification Preferences</button>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div id="privacy" class="card settings-card shadow mb-4" style="display: none;">
                    <div class="card-header bg-warning text-white">
                        <h5 class="mb-0">üëÅÔ∏è Privacy Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="dataSharing">
                            <label class="form-check-label" for="dataSharing">Allow anonymous usage data collection</label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="marketingEmails">
                            <label class="form-check-label" for="marketingEmails">Receive marketing emails</label>
                        </div>

                        <hr class="my-4">

                        <h6>Data & Privacy</h6>
                        <p class="text-muted small">Download or delete your account data</p>
                        <button class="btn btn-outline-secondary" onclick="downloadData()">üì• Download My Data</button>
                        <button class="btn btn-outline-danger" onclick="deleteAccount()">üóëÔ∏è Delete Account</button>
                    </div>
                </div>

                <!-- Advanced Settings -->
                <div id="advanced" class="card settings-card shadow mb-4" style="display: none;">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">‚öôÔ∏è Advanced Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Screenshot Quality</label>
                            <select class="form-select">
                                <option>High (Best quality, larger files)</option>
                                <option selected>Medium (Balanced)</option>
                                <option>Low (Smaller files, faster upload)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Live Stream Refresh Rate</label>
                            <select class="form-select">
                                <option>2 seconds (Most responsive)</option>
                                <option selected>5 seconds</option>
                                <option>10 seconds (Reduced bandwidth)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Auto-lock after (minutes)</label>
                            <input type="number" class="form-control" value="15" min="5" max="120">
                        </div>
                        <button class="btn btn-secondary" onclick="saveAdvanced()">Save Advanced Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Tab switching
        document.querySelectorAll('.list-group-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const target = this.getAttribute('href');
                
                document.querySelectorAll('[id^="profile"], [id^="security"], [id^="notifications"], [id^="privacy"], [id^="advanced"]').forEach(el => {
                    if(el.id.length <= 15) el.style.display = 'none';
                });
                
                document.querySelector(target).style.display = 'block';
                
                document.querySelectorAll('.list-group-item').forEach(el => el.classList.remove('active'));
                this.classList.add('active');
            });
        });

        function saveProfile() {
            alert('Profile saved successfully!');
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if(!current || !newPass || !confirm) {
                alert('Please fill all fields');
                return;
            }
            
            if(newPass !== confirm) {
                alert('New passwords do not match');
                return;
            }
            
            fetch('/api/change_password', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ current_password: current, new_password: newPass })
            }).then(res => res.json()).then(data => {
                if(data.success) {
                    alert('Password changed successfully');
                } else {
                    alert('Error: ' + data.message);
                }
            });
        }

        function enable2FA() {
            alert('2FA setup would open a QR code scanner');
        }

        function saveNotifications() {
            alert('Notification preferences saved!');
        }

        function downloadData() {
            alert('Your data will be prepared for download');
        }

        function deleteAccount() {
            if(!confirm('Are you sure? This action cannot be undone.')) return;
            alert('Account deletion request submitted');
        }

        function saveAdvanced() {
            alert('Advanced settings saved!');
        }
    </script>
</body>
</html>
